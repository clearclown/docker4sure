#!/bin/bash
# docker4sure: Transparent Docker-to-Podman redirect wrapper
# When DOCKER_REAL=1 is set, use the real docker binary

set -euo pipefail

# If DOCKER_REAL is set, use the real docker
if [[ "${DOCKER_REAL:-}" == "1" ]]; then
    DOCKER_BIN="/usr/bin/docker"
    if [[ "$(uname -s)" == "Darwin" ]]; then
        if [[ -x "/usr/local/bin/docker" ]]; then
            DOCKER_BIN="/usr/local/bin/docker"
        elif [[ -x "/opt/homebrew/bin/docker" ]]; then
            DOCKER_BIN="/opt/homebrew/bin/docker"
        fi
    fi
    exec "$DOCKER_BIN" "$@"
fi

# Handle 'docker compose' â†’ 'podman-compose'
if [[ "${1:-}" == "compose" ]]; then
    shift
    exec podman-compose "$@"
fi

# Default: forward to podman
exec podman "$@"
